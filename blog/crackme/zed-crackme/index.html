<!doctype html><html lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="text/html; charset=UTF-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1,user-scalable=no" name=viewport><meta content="index, follow" name=robots><title>ZED-Crackme made by zed-zahir</title><meta content="ZED-Crackme made by zed-zahir" name=title><meta content=Falcon name=author><meta content=website property=og:type><meta content=https://0xf4lc0n.github.io/blog/crackme/zed-crackme/ property=og:url><meta property=og:site_name><meta content="ZED-Crackme made by zed-zahir" property=og:title><meta content=https://0xf4lc0n.github.io/favicon.ico property=og:image><link href=https://0xf4lc0n.github.io/blog/crackme/zed-crackme/ rel=canonical><link rel="shortcut icon" href=https://0xf4lc0n.github.io/favicon.ico type=image/x-icon><link href=https://0xf4lc0n.github.io/atom.xml rel=alternate title=RSS type=application/atom+xml><link href=https://0xf4lc0n.github.io/css/style.css rel=stylesheet><script defer src=https://0xf4lc0n.github.io/js/script.js></script><body><div class=wrapper><header><nav class=navBar><a href=/> /home/ </a><a href=/blog> /blog/ </a><a href=/about> /about/ </a><div class=themeSwitch><button class="themeButton dark" onclick="setTheme('dark')" title="Dark mode"><svg class="icons icons__background"><use href=https://0xf4lc0n.github.io/icons.svg#darkMode></use></svg></button><button class="themeButton light" onclick="setTheme('light')" title="Light mode"><svg class="icons icons__background"><use href=https://0xf4lc0n.github.io/icons.svg#lightMode></use></svg></button></div></nav></header><main><h1>ZED-Crackme made by zed-zahir</h1><p><a href=https://crackmes.one/crackme/5ecd7cc133c5d449d91ae641 rel=noopener target=_blank>Download binary</a><p>When I unpacked the archive and tried to run crackme, a segmentation fault error has occured.<pre class=language-txt data-lang=txt style=background:#282828;color:#fdf4c1aa><code class=language-txt data-lang=txt><span># ./ZED-Crackme-x64.bin 
</span><span>[1]    11303 segmentation fault (core dumped)  ./ZED-Crackme-x64.bin
</span></code></pre><p>By using the string command I recognized that the file was packed with UPX:<pre class=language-txt data-lang=txt style=background:#282828;color:#fdf4c1aa><code class=language-txt data-lang=txt><span>...
</span><span>$Info: This file is packed with the UPX executable packer http://upx.sf.net $
</span><span>$Id: UPX 3.94 Copyright (C) 1996-2017 the UPX Team. All Rights Reserved. $
</span><span>...
</span></code></pre><p>After unpacking the file it ran properly:<pre class=language-txt data-lang=txt style=background:#282828;color:#fdf4c1aa><code class=language-txt data-lang=txt><span># upx -d ZED-Crackme-x64.bin 
</span><span># ./ZED-Crackme-x64.bin
</span><span>***********************
</span><span>**      rules:       **
</span><span>***********************
</span><span>
</span><span>* do not bruteforce
</span><span>* do not patch, find instead the serial.
</span><span>
</span><span>enter the passphrase: test
</span><span>try again
</span></code></pre><p>The program displayed the rules and waited for password.<p>I opened it in IDA. Here we get a first part of a main function:<p><img alt src=https://0xf4lc0n.github.io/blog/crackme/zed-crackme/img/main_stage_1.png><p>After printing rules program saves a null terminated string into memory:<pre class=language-nasm data-lang=nasm style=background:#282828;color:#fdf4c1aa><code class=language-nasm data-lang=nasm><span style=color:#fa5c4b>mov     </span><span style=color:#fdf4c1>rax, </span><span style=color:#d3869b>2073692073696854h
</span><span style=color:#fa5c4b>mov     </span><span style=color:#fdf4c1>rdx, </span><span style=color:#d3869b>657320706F742061h
</span><span style=color:#fa5c4b>mov     </span><span style=color:#fdf4c1>[rbp+</span><span style=color:#8ec07c>var_30</span><span style=color:#fdf4c1>], rax
</span><span style=color:#fa5c4b>mov     </span><span style=color:#fdf4c1>[rbp+</span><span style=color:#8ec07c>var_28</span><span style=color:#fdf4c1>], rdx
</span><span style=color:#fa5c4b>mov     </span><span style=color:#fdf4c1>rax, </span><span style=color:#d3869b>7865742074657263h
</span><span style=color:#fa5c4b>mov     </span><span style=color:#fdf4c1>rdx, </span><span style=color:#d3869b>67617373656D2074h
</span><span style=color:#fa5c4b>mov     </span><span style=color:#fdf4c1>[rbp+</span><span style=color:#8ec07c>var_20</span><span style=color:#fdf4c1>], rax
</span><span style=color:#fa5c4b>mov     </span><span style=color:#fdf4c1>[rbp+</span><span style=color:#8ec07c>var_18</span><span style=color:#fdf4c1>], rdx
</span><span style=color:#fa5c4b>mov     </span><span style=color:#fdf4c1>[rbp+</span><span style=color:#8ec07c>var_10</span><span style=color:#fdf4c1>], </span><span style=color:#d3869b>2165h
</span><span style=color:#fa5c4b>mov     </span><span style=color:#fdf4c1>[rbp+</span><span style=color:#8ec07c>var_E</span><span style=color:#fdf4c1>], </span><span style=color:#d3869b>0
</span></code></pre><p>Let’s call this string “message”.<p>So “message” contains “This is a top secret text message!”.<p>Next the program checks if it has been run in the virtual machine. If so, the program is terminated otherwise execution proceeds to the next stage.<p><img alt src=https://0xf4lc0n.github.io/blog/crackme/zed-crackme/img/main_stage_2.png><p>The “message” address is loaded to rax register then copied to rsi and rot function is called. The process is then repeated.<pre class=language-nasm data-lang=nasm style=background:#282828;color:#fdf4c1aa><code class=language-nasm data-lang=nasm><span style=color:#fa5c4b>lea     </span><span style=color:#fdf4c1>rax, [rbp+</span><span style=color:#8ec07c>var_30</span><span style=color:#fdf4c1>]
</span><span style=color:#fa5c4b>mov     </span><span style=color:#fdf4c1>rsi, rax
</span><span style=color:#fa5c4b>mov     </span><span style=color:#fdf4c1>edi, </span><span style=color:#d3869b>0Dh
</span><span style=color:#fa5c4b>call    </span><span style=color:#8ec07c>rot
</span><span style=color:#fa5c4b>lea     </span><span style=color:#fdf4c1>rax, [rbp+</span><span style=color:#8ec07c>var_30</span><span style=color:#fdf4c1>]
</span><span style=color:#fa5c4b>mov     </span><span style=color:#fdf4c1>rsi, rax
</span><span style=color:#fa5c4b>mov     </span><span style=color:#fdf4c1>edi, </span><span style=color:#d3869b>0Dh
</span><span style=color:#fa5c4b>call    </span><span style=color:#8ec07c>rot
</span></code></pre><p>ROT13 is its own inverse so “message” is firstly encoded and then decoded.<pre class=language-txt data-lang=txt style=background:#282828;color:#fdf4c1aa><code class=language-txt data-lang=txt><span>"This is a top secret text message!" => rot13 => "Guvf vf n gbc frperg grkg zrffntr!"
</span><span>"Guvf vf n gbc frperg grkg zrffntr!" => rot13 => "This is a top secret text message!"
</span></code></pre><p>However “message” won’t be used any more in the program and it doesn’t have any influence on serial key generation.<p>Next the another string is saved into memory. I named it “password_base”.<pre class=language-nasm data-lang=nasm style=background:#282828;color:#fdf4c1aa><code class=language-nasm data-lang=nasm><span style=color:#fa5c4b>mov     </span><span style=color:#fdf4c1>rax, </span><span style=color:#d3869b>4145443332694841h
</span><span style=color:#fa5c4b>mov     </span><span style=color:#fdf4c1>rdx, </span><span style=color:#d3869b>464F434645454244h
</span><span style=color:#fa5c4b>mov     </span><span style=color:#fdf4c1>[rbp+</span><span style=color:#8ec07c>var_90</span><span style=color:#fdf4c1>], rax
</span><span style=color:#fa5c4b>mov     </span><span style=color:#fdf4c1>[rbp+</span><span style=color:#8ec07c>var_88</span><span style=color:#fdf4c1>], rdx
</span><span style=color:#fa5c4b>mov     </span><span style=color:#fdf4c1>[rbp+</span><span style=color:#8ec07c>var_80</span><span style=color:#fdf4c1>], </span><span style=color:#d3869b>4546h
</span><span style=color:#fa5c4b>mov     </span><span style=color:#fdf4c1>[rbp+</span><span style=color:#8ec07c>var_7E</span><span style=color:#fdf4c1>], </span><span style=color:#d3869b>45h
</span></code></pre><p>The “password_base” contains “AHi23DEADBEEFCOFFEE” and this string will be used to create serial key. In the next lines program takes input from user and calls ptrace in order to check if it’s currently debugging. If so the program is terminated otherwise it will start creating a serial key.<p>Here the program creates the first five letters of the key:<p><img alt src=https://0xf4lc0n.github.io/blog/crackme/zed-crackme/img/main_stage_3.png><p>The folowing listing listing extxts that part:<pre class=language-nasm data-lang=nasm style=background:#282828;color:#fdf4c1aa><code class=language-nasm data-lang=nasm><span style=font-style:italic;color:#928374>; rbp+var_90 => "AHi23DEADBEEFCOFFEE"
</span><span style=color:#fa5c4b>movzx   </span><span style=color:#fdf4c1>eax, </span><span style=color:#fabd2f>byte ptr </span><span style=color:#fdf4c1>[rbp+</span><span style=color:#8ec07c>var_90</span><span style=color:#fdf4c1>]</span><span style=font-style:italic;color:#928374>      ; eax = 0x41 'A'
</span><span style=color:#fa5c4b>xor     </span><span style=color:#fdf4c1>eax, </span><span style=color:#d3869b>2</span><span style=font-style:italic;color:#928374>                          ; eax = 0x43 'C'
</span><span style=color:#fa5c4b>mov     </span><span style=color:#fdf4c1>[rbp+</span><span style=color:#8ec07c>s1</span><span style=color:#fdf4c1>], al</span><span style=font-style:italic;color:#928374>                    ; serial_key[0] = 'C'
</span><span style=color:#fa5c4b>movzx   </span><span style=color:#fdf4c1>eax, </span><span style=color:#fabd2f>byte ptr </span><span style=color:#fdf4c1>[rbp+</span><span style=color:#8ec07c>var_90</span><span style=color:#fdf4c1>+</span><span style=color:#d3869b>3</span><span style=color:#fdf4c1>]</span><span style=font-style:italic;color:#928374>    ; eax = 0x32 '2'
</span><span style=color:#fa5c4b>sub     </span><span style=color:#fdf4c1>eax, </span><span style=color:#d3869b>0Ah</span><span style=font-style:italic;color:#928374>                        ; eax = 0x28 '('
</span><span style=color:#fa5c4b>mov     </span><span style=color:#fdf4c1>[rbp+</span><span style=color:#8ec07c>var_4F</span><span style=color:#fdf4c1>], al</span><span style=font-style:italic;color:#928374>                ; serial_key[1] = '('
</span><span style=color:#fa5c4b>movzx   </span><span style=color:#fdf4c1>eax, </span><span style=color:#fabd2f>byte ptr </span><span style=color:#fdf4c1>[rbp+</span><span style=color:#8ec07c>var_90</span><span style=color:#fdf4c1>+</span><span style=color:#d3869b>2</span><span style=color:#fdf4c1>]</span><span style=font-style:italic;color:#928374>    ; eax = 0x69 'i'
</span><span style=color:#fa5c4b>add     </span><span style=color:#fdf4c1>eax, </span><span style=color:#d3869b>0Ch</span><span style=font-style:italic;color:#928374>                        ; eax = 0x75 'u'
</span><span style=color:#fa5c4b>mov     </span><span style=color:#fdf4c1>[rbp+</span><span style=color:#8ec07c>var_4E</span><span style=color:#fdf4c1>], al</span><span style=font-style:italic;color:#928374>                ; serial_key[2] = 'u'
</span><span style=color:#fa5c4b>movzx   </span><span style=color:#fdf4c1>eax, </span><span style=color:#fabd2f>byte ptr </span><span style=color:#fdf4c1>[rbp+</span><span style=color:#8ec07c>var_90</span><span style=color:#fdf4c1>+</span><span style=color:#d3869b>2</span><span style=color:#fdf4c1>]</span><span style=font-style:italic;color:#928374>    ; eax = 0x69 'i'
</span><span style=color:#fa5c4b>mov     </span><span style=color:#fdf4c1>[rbp+</span><span style=color:#8ec07c>var_4D</span><span style=color:#fdf4c1>], al</span><span style=font-style:italic;color:#928374>                ; seial_key[3] = 'i'
</span><span style=color:#fa5c4b>movzx   </span><span style=color:#fdf4c1>eax, </span><span style=color:#fabd2f>byte ptr </span><span style=color:#fdf4c1>[rbp+</span><span style=color:#8ec07c>var_90</span><span style=color:#fdf4c1>+</span><span style=color:#d3869b>1</span><span style=color:#fdf4c1>]</span><span style=font-style:italic;color:#928374>    ; eax = 0x48 'H'
</span><span style=color:#fa5c4b>add     </span><span style=color:#fdf4c1>eax, </span><span style=color:#d3869b>1</span><span style=font-style:italic;color:#928374>                          ; eax = 0x49 'I'
</span><span style=color:#fa5c4b>mov     </span><span style=color:#fdf4c1>[rbp+</span><span style=color:#8ec07c>var_4C</span><span style=color:#fdf4c1>], al</span><span style=font-style:italic;color:#928374>                ; serial_key[4] = 'I'
</span></code></pre><p>Then program sets index to 5 and jumps to loop.<pre class=language-nasm data-lang=nasm style=background:#282828;color:#fdf4c1aa><code class=language-nasm data-lang=nasm><span style=color:#fa5c4b>mov     </span><span style=color:#fdf4c1>[rbp+</span><span style=color:#8ec07c>var_9C</span><span style=color:#fdf4c1>], </span><span style=color:#d3869b>5
</span></code></pre><p><img alt src=https://0xf4lc0n.github.io/blog/crackme/zed-crackme/img/main_stage_4.png><p>Here we got a loop condition:<pre class=language-nasm data-lang=nasm style=background:#282828;color:#fdf4c1aa><code class=language-nasm data-lang=nasm><span style=color:#fa5c4b>cmp     </span><span style=color:#fdf4c1>[rbp+</span><span style=color:#8ec07c>var_9C</span><span style=color:#fdf4c1>], </span><span style=color:#d3869b>12h</span><span style=font-style:italic;color:#928374>               ; proceed until index isn't equal to 18
</span><span style=color:#fa5c4b>jle     </span><span style=color:#8ec07c>short loc_1514
</span></code></pre><p>In loop program takes each character from “base_password” (starting from 6th character), subtracts 1 from character’s ascii code and then puts the new character into memory (in serial_key array).<p>Here is a simple Python script that creates the required serial key:<pre class=language-python data-lang=python style=background:#282828;color:#fdf4c1aa><code class=language-python data-lang=python><span>password_base </span><span style=color:#fe8019>= </span><span style=color:#b8bb26>"AHi23DEADBEEFCOFFEE"
</span><span>decoded_password </span><span style=color:#fe8019>= </span><span>[]
</span><span>
</span><span style=color:#fdf4c1>decoded_password.append(</span><span style=color:#fabd2f>chr</span><span style=color:#fdf4c1>(</span><span style=color:#fabd2f>ord</span><span style=color:#fdf4c1>(password_base[</span><span style=color:#d3869b>0</span><span style=color:#fdf4c1>]) </span><span style=color:#fe8019>^ </span><span style=color:#d3869b>2</span><span style=color:#fdf4c1>))
</span><span style=color:#fdf4c1>decoded_password.append(</span><span style=color:#fabd2f>chr</span><span style=color:#fdf4c1>(</span><span style=color:#fabd2f>ord</span><span style=color:#fdf4c1>(password_base[</span><span style=color:#d3869b>3</span><span style=color:#fdf4c1>]) </span><span style=color:#fe8019>- </span><span style=color:#d3869b>0x0A</span><span style=color:#fdf4c1>))
</span><span style=color:#fdf4c1>decoded_password.append(</span><span style=color:#fabd2f>chr</span><span style=color:#fdf4c1>(</span><span style=color:#fabd2f>ord</span><span style=color:#fdf4c1>(password_base[</span><span style=color:#d3869b>2</span><span style=color:#fdf4c1>]) </span><span style=color:#fe8019>+ </span><span style=color:#d3869b>0x0C</span><span style=color:#fdf4c1>))
</span><span style=color:#fdf4c1>decoded_password.append(password_base[</span><span style=color:#d3869b>2</span><span style=color:#fdf4c1>])
</span><span style=color:#fdf4c1>decoded_password.append(</span><span style=color:#fabd2f>chr</span><span style=color:#fdf4c1>(</span><span style=color:#fabd2f>ord</span><span style=color:#fdf4c1>(password_base[</span><span style=color:#d3869b>1</span><span style=color:#fdf4c1>]) </span><span style=color:#fe8019>+ </span><span style=color:#d3869b>1</span><span style=color:#fdf4c1>))
</span><span>
</span><span style=color:#fa5c4b>for </span><span>c </span><span style=color:#fa5c4b>in </span><span>password_base[</span><span style=color:#d3869b>5</span><span>:]:
</span><span>    </span><span style=color:#fdf4c1>decoded_password.append(</span><span style=color:#fabd2f>chr</span><span style=color:#fdf4c1>(</span><span style=color:#fabd2f>ord</span><span style=color:#fdf4c1>(c) </span><span style=color:#fe8019>- </span><span style=color:#d3869b>1</span><span style=color:#fdf4c1>))
</span><span>
</span><span style=color:#fabd2f>print</span><span style=color:#fdf4c1>(</span><span style=color:#b8bb26>"Decoded serial key: "</span><span style=color:#fdf4c1>, </span><span style=color:#b8bb26>""</span><span style=color:#fdf4c1>.join(decoded_password))
</span></code></pre><p>And that’s all. When the program creates a serial key, it compares the serial key with the data entered by user. If both strings are the same, crackme is resolved.<pre class=language-nasm data-lang=nasm style=background:#282828;color:#fdf4c1aa><code class=language-nasm data-lang=nasm><span style=color:#fa5c4b>lea     </span><span style=color:#fdf4c1>rdx, [rbp+</span><span style=color:#8ec07c>s2</span><span style=color:#fdf4c1>]
</span><span style=color:#fa5c4b>lea     </span><span style=color:#fdf4c1>rax, [rbp+</span><span style=color:#8ec07c>s1</span><span style=color:#fdf4c1>]
</span><span style=color:#fa5c4b>mov     </span><span style=color:#fdf4c1>rsi, rdx</span><span style=font-style:italic;color:#928374>        ; s2
</span><span style=color:#fa5c4b>mov     </span><span style=color:#fdf4c1>rdi, rax</span><span style=font-style:italic;color:#928374>        ; s1
</span><span style=color:#fa5c4b>call    </span><span style=color:#8ec07c>_strcmp
</span><span style=color:#fa5c4b>test    </span><span style=color:#fdf4c1>eax, eax
</span><span style=color:#fa5c4b>jnz     </span><span style=color:#8ec07c>short loc_156A</span><span style=font-style:italic;color:#928374>   ; bad serial key
</span><span style=color:#fa5c4b>lea     </span><span style=color:#fdf4c1>rdi, </span><span style=color:#8ec07c>aYouSucceed</span><span style=font-style:italic;color:#928374> ; "you succeed!!"
</span><span style=color:#fa5c4b>call    </span><span style=color:#8ec07c>_puts
</span><span style=color:#fa5c4b>jmp     </span><span style=color:#8ec07c>short loc_1576</span><span style=font-style:italic;color:#928374>   ; end program
</span></code></pre><pre class=language-txt data-lang=txt style=background:#282828;color:#fdf4c1aa><code class=language-txt data-lang=txt><span># ./ZED-Crackme-x64.bin 
</span><span>***********************
</span><span>**      rules:       **
</span><span>***********************
</span><span>
</span><span>* do not bruteforce
</span><span>* do not patch, find instead the serial.
</span><span>
</span><span>enter the passphrase: C(uiICD@CADDEBNEEDD
</span><span>you succeed!!
</span></code></pre><p>Used tools:<ul><li>Ida Freeware 7.0<li>GDB</ul><p class=tagsData></main><footer><hr><div class=footContainer><div class=footLeft><p>Licensed under <a rel="noopener noreferrer" href=https://fr.wikipedia.org/wiki/Licence_MIT target=_blank>MIT</a><br> Built with <a rel="noopener noreferrer" href=https://www.getzola.org target=_blank>Zola</a> using <a rel="noopener noreferrer" href=https://github.com/Speyll/anemone target=_blank>anemone</a> theme & <a rel="noopener noreferrer" href=https://github.com/Speyll/veqev target=_blank>veqev</a> colors.<br></div><div class=footRight><a rel="noopener noreferrer" title="Subscribe via RSS for updates." class=icons__background href=https://0xf4lc0n.github.io/atom.xml target=_blank><svg class="icons icons__background"><use href=https://0xf4lc0n.github.io/icons.svg#rss></use></svg></a></div></div></footer></div>