<!doctype html><html lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="text/html; charset=UTF-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1,user-scalable=no" name=viewport><meta content="index, follow" name=robots><title>Detonation</title><meta content=Detonation name=title><meta content=Falcon name=author><meta content=website property=og:type><meta content=https://0xf4lc0n.github.io/blog/first-steps-in-re/detonation/ property=og:url><meta property=og:site_name><meta content=Detonation property=og:title><meta content=https://0xf4lc0n.github.io/favicon.ico property=og:image><link href=https://0xf4lc0n.github.io/blog/first-steps-in-re/detonation/ rel=canonical><link rel="shortcut icon" href=https://0xf4lc0n.github.io/favicon.ico type=image/x-icon><link href=https://0xf4lc0n.github.io/atom.xml rel=alternate title=RSS type=application/atom+xml><link href=https://0xf4lc0n.github.io/css/style.css rel=stylesheet><script defer src=https://0xf4lc0n.github.io/js/script.js></script><body><div class=wrapper><header><nav class=navBar><a href=/> /home/ </a><a href=/blog> /blog/ </a><a href=/about> /about/ </a><div class=themeSwitch><button class="themeButton dark" onclick="setTheme('dark')" title="Dark mode"><svg class="icons icons__background"><use href=https://0xf4lc0n.github.io/icons.svg#darkMode></use></svg></button><button class="themeButton light" onclick="setTheme('light')" title="Light mode"><svg class="icons icons__background"><use href=https://0xf4lc0n.github.io/icons.svg#lightMode></use></svg></button></div></nav></header><main><h1>Detonation</h1><p>Here I performed controlled execution. For that I userd Wireshark, Burp Suite, INetSim and Procmon.<p>I opened malicious doc file and turned on macros.<p><img alt src=https://0xf4lc0n.github.io/blog/first-steps-in-re/detonation/img/procmon.png><p>After a while I turned off capturing in Procmon (Ctrl + E) and then I opened Process Tree (Ctrl + T). I expanded wininit.exe and searched PowerShell process started by wmiprvse.exe.<p><img alt src=https://0xf4lc0n.github.io/blog/first-steps-in-re/detonation/img/wininit_exe.png> <img alt src=https://0xf4lc0n.github.io/blog/first-steps-in-re/detonation/img/power_shell.png><p>Then I right clicked on PowerShell process and selected option “Go To Event”. I closed Process Tree and in Procmon I right clicked on PowerShell entry and selected Properties.<p><img alt src=https://0xf4lc0n.github.io/blog/first-steps-in-re/detonation/img/power_shell_proc_mon.png><p>In “Event” and “Process” tab I found encoded PowerShell script, but I had already got it. Then I went to home directory and found there 126.exe.<p><img alt src=https://0xf4lc0n.github.io/blog/first-steps-in-re/detonation/img/126_exe.png><p>The file should contain html code from INetSim and it really did.<p><img alt src=https://0xf4lc0n.github.io/blog/first-steps-in-re/detonation/img/hxd.png><p>On my Linux machine I turned off INetSim and opened report file. The most interesting was the following part:<pre class=language-txt data-lang=txt style=background:#282828;color:#fdf4c1aa><code class=language-txt data-lang=txt><span>2020-01-12 18:53:52  DNS connection, type: A, class: IN, requested name: www.pieceofpassion.net
</span><span>2020-01-12 18:53:52  HTTP connection, method: GET, URL: http://www.pieceofpassion.net/0xrnl3/a27xm99fgd_on7xp-31134189/, file name: data/http/fakefiles/sample.html
</span><span>2020-01-12 18:53:52  DNS connection, type: A, class: IN, requested name: www.marketfxelite.com
</span><span>2020-01-12 18:53:52  HTTP connection, method: GET, URL: http://www.marketfxelite.com/wp-admin/unnJtCHk/, file name: data/http/fakefiles/sample.html
</span><span>2020-01-12 18:53:52  DNS connection, type: A, class: IN, requested name: tananfood.com
</span><span>2020-01-12 18:53:53  DNS connection, type: A, class: IN, requested name: raisabook.com
</span><span>2020-01-12 18:53:53  HTTP connection, method: GET, URL: http://raisabook.com/wp-content/NjBtuxBzkD/, file name: data/http/fakefiles/sample.html
</span><span>2020-01-12 18:53:53  DNS connection, type: A, class: IN, requested name: biswalfoodcircle.com
</span><span>2020-01-12 18:53:53  DNS connection, type: A, class: IN, requested name: biswalfoodcircle.com
</span><span>2020-01-12 18:53:53  HTTP connection, method: GET, URL: http://biswalfoodcircle.com/vcobhlons/kaf6j_71wzkgvqso-8/, file name: data/http/fakefiles/sample.html
</span></code></pre><p>Additionaly Burp Suite captured that:<p><img alt src=https://0xf4lc0n.github.io/blog/first-steps-in-re/detonation/img/burp_suite_https_con.png><p>So domains that I had to check were:<pre class=language-txt data-lang=txt style=background:#282828;color:#fdf4c1aa><code class=language-txt data-lang=txt><span>http://www.pieceofpassion.net/0xrnl3/a27xm99fgd_on7xp-31134189/
</span><span>http://www.marketfxelite.com/wp-admin/unnJtCHk/
</span><span>http://raisabook.com/wp-content/NjBtuxBzkD/
</span><span>http://biswalfoodcircle.com/vcobhlons/kaf6j_71wzkgvqso-8/
</span><span>https://tananfood.com/wp-includes/yoclwyWE/
</span></code></pre><p>I used “http || udp” filter to gain information about packet traffic:<p><img alt src=https://0xf4lc0n.github.io/blog/first-steps-in-re/detonation/img/wireshark_inetsim.png><h4 id=table-of-content>Table of content:</h4><ol><li><a href=/blog/first-steps-in-re/environment-configuration>Environment configuration</a><li><a href=/blog/first-steps-in-re/initial-analysis>Initial analysis</a><li><a href=/blog/first-steps-in-re/macro-analysis>Macro analysis</a><li><a href=/blog/first-steps-in-re/dropper-analysis>Dropper analysis</a><li><a href=/blog/first-steps-in-re/detonation>Detonation</a><li><a href=/blog/first-steps-in-re/domain-analysis>Domain analysis</a><li><a href=/blog/first-steps-in-re/detonation-v2>Detonation ver. 2</a><li><a href=/blog/first-steps-in-re/summary>Summary</a></ol><p class=tagsData></main><footer><hr><div class=footContainer><div class=footLeft><p>Licensed under <a rel="noopener noreferrer" href=https://fr.wikipedia.org/wiki/Licence_MIT target=_blank>MIT</a><br> Built with <a rel="noopener noreferrer" href=https://www.getzola.org target=_blank>Zola</a> using <a rel="noopener noreferrer" href=https://github.com/Speyll/anemone target=_blank>anemone</a> theme & <a rel="noopener noreferrer" href=https://github.com/Speyll/veqev target=_blank>veqev</a> colors.<br></div><div class=footRight><a rel="noopener noreferrer" title="Subscribe via RSS for updates." class=icons__background href=https://0xf4lc0n.github.io/atom.xml target=_blank><svg class="icons icons__background"><use href=https://0xf4lc0n.github.io/icons.svg#rss></use></svg></a></div></div></footer></div>